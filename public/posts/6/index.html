<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Top 10 Argo Workflows Examples. | Dataware Logistics</title>
<meta name="keywords" content="Kubernetes, Argo, Development, Infrastructure Observability">
<meta name="description" content="We all know how Argo Workflows makes it easy to orchestrate parallel jobs on Kubernetes. While itâ€™s most often associated with data processing and ETL projects, itâ€™s useful for a lot more! These 10 workflows will change the way you see this Kubernetes orchestrator.
Letâ€™s dive in!
Argo Workflows Setup
If you don&rsquo;t currently have a workflow running, I suggest you create your first Argo Workflow to understand what we&rsquo;ll discuss in this post.">
<meta name="author" content="Daniel Paes">
<link rel="canonical" href="https://pipekit.io/blog/top-10-argo-workflows-examples">
<meta name="google-site-verification" content="4599922566">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.dawrlog.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.dawrlog.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.dawrlog.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://www.dawrlog.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.dawrlog.com/apple-touch-icon.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://www.dawrlog.com/posts/6/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Top 10 Argo Workflows Examples." />
<meta property="og:description" content="We all know how Argo Workflows makes it easy to orchestrate parallel jobs on Kubernetes. While itâ€™s most often associated with data processing and ETL projects, itâ€™s useful for a lot more! These 10 workflows will change the way you see this Kubernetes orchestrator.
Letâ€™s dive in!
Argo Workflows Setup
If you don&rsquo;t currently have a workflow running, I suggest you create your first Argo Workflow to understand what we&rsquo;ll discuss in this post." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.dawrlog.com/posts/6/" />
<meta property="og:image" content="https://user-images.githubusercontent.com/78096758/217081520-1f3b6771-8cf8-434b-b8fe-d11c17d380b5.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-12T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://user-images.githubusercontent.com/78096758/217081520-1f3b6771-8cf8-434b-b8fe-d11c17d380b5.png" />
<meta name="twitter:title" content="Top 10 Argo Workflows Examples."/>
<meta name="twitter:description" content="We all know how Argo Workflows makes it easy to orchestrate parallel jobs on Kubernetes. While itâ€™s most often associated with data processing and ETL projects, itâ€™s useful for a lot more! These 10 workflows will change the way you see this Kubernetes orchestrator.
Letâ€™s dive in!
Argo Workflows Setup
If you don&rsquo;t currently have a workflow running, I suggest you create your first Argo Workflow to understand what we&rsquo;ll discuss in this post."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://www.dawrlog.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Top 10 Argo Workflows Examples.",
      "item": "https://www.dawrlog.com/posts/6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Top 10 Argo Workflows Examples.",
  "name": "Top 10 Argo Workflows Examples.",
  "description": "We all know how Argo Workflows makes it easy to orchestrate parallel jobs on Kubernetes. While itâ€™s most often associated with data processing and ETL projects, itâ€™s useful for a lot more! These 10 workflows will change the way you see this Kubernetes orchestrator.\nLetâ€™s dive in!\nArgo Workflows Setup\nIf you don\u0026rsquo;t currently have a workflow running, I suggest you create your first Argo Workflow to understand what we\u0026rsquo;ll discuss in this post.",
  "keywords": [
    "Kubernetes", "Argo", "Development", "Infrastructure Observability"
  ],
  "articleBody": "We all know how Argo Workflows makes it easy to orchestrate parallel jobs on Kubernetes. While itâ€™s most often associated with data processing and ETL projects, itâ€™s useful for a lot more! These 10 workflows will change the way you see this Kubernetes orchestrator.\nLetâ€™s dive in!\nArgo Workflows Setup\nIf you donâ€™t currently have a workflow running, I suggest you create your first Argo Workflow to understand what weâ€™ll discuss in this post. To do so, follow the instructions here to create a local Argo Workflows deployment on your cluster. I also suggest using k3d for your local Kubernetes control plane; this tutorial uses a k3d cluster named argo. Feel free to reproduce the command below to create it in your environment:\nk3d cluster create argo kubectl create -n argo -f https://raw.githubusercontent.com/argoproj/argo-workflows/master/manifests/quick-start-postgres.yaml kubectl -n argo port-forward deployment/argo-server 2746:2746 \u0026 Now letâ€™s jump into looking at our first example!\n1. Enhancing Your Workflow Using Parameters\nArgo uses custom resource definitions stored on YAML files to manage its deployments. So no need to learn new specs to manage your infrastructure; you can follow the same pattern used on your Kubernetes and Kustomize scripts, which helps you remain consistent. Below we can see how to use parameters on your workflows, and passing parameters is handy when your configuration uses runtime values. As a result, you will know some components only after creating them, such as access tokens.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: hello-world-parameters- spec: entrypoint: whalesay arguments: parameters: - name: message value: Message string default value templates: - name: whalesay inputs: parameters: - name: message container: image: docker/whalesay command: [cowsay] args: [\"{{inputs.parameters.message}}\"] In our template, the parameter message will have the default value of Message string default value. However, this value can be overwritten at runtime, as we can see by running the command below:\nargo submit -n argo param.yml -p message=\"This ran from your container\" --watch We can validate the output from the Argo Workflows Logs UI. (You can access the UI by default at https://localhost:2746/ if you quickly follow the port forwarding instructions while creating your cluster.)\n2. Pulling Images From Your Secured Repository\nOne of the features I like when automating an ecosystem is using rotational access keys while managing my servicesâ€™ access. This is useful in cases where your company uses private container repositories to host your container images. Argo Workflows helps you achieve this with the native support of Kubernetes secrets. In our example, we can see that the secret docker-registry-secret will pull the image docker/whalesay:latest.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: hello-world- spec: entrypoint: whalesay imagePullSecrets: - name: docker-registry-secret templates: - name: whalesay container: image: docker/whalesay:latest command: [cowsay] args: [\"hello world\"] 3. Using Sidecar Containers One of my favorite things to do is to use sidecars while starting my pods. Kubernetes sidecars are useful helpers that can handle recurring tasks, such as syncing your Git repositories with git-sync as shown here. Argo Workflows has this covered with neat support for sidecar containers out of the box.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: sidecar-nginx- spec: entrypoint: sidecar-nginx-example templates: - name: sidecar-nginx-example container: image: appropriate/curl command: [sh, -c] args: [\"until `curl -G 'http://127.0.0.1/' \u003e\u0026 /tmp/out`; do echo sleep \u0026\u0026 sleep 1; done \u0026\u0026 cat /tmp/out\"] sidecars: - name: nginx image: nginx:1.13 To deploy it, save the above code as sidecar-nginx.yml and submit it:\nargo submit -n argo sidecar-nginx.yml --watch And as a result, youâ€™ll deploy an NGINXâ€™s reverse proxy sidecar instance.\n**Pro-tip: You might need to pay some extra attention to your workflows if youâ€™re using Istio as Service mesh. Check out at this GitHub thread if youâ€™re thinking of using it. **\n4. Archiving Your Current Workflow State on Persistent Storage\nWorkflow Archive is a nice feature that Argo Workflows provides so you can have previous workflow states stored on a relational database (Postgres or MySQL for now). However, Argoâ€™s archive wonâ€™t keep detailed execution logs; youâ€™ll need to configure an Object storage as artifact repository, it can be an opensource option like MinIO, or AWS S3; to mention a cloud provider option from AWS.\nTo use the archive feature, youâ€™ll first need to configure your Argo serverâ€™s persistent storage option. Youâ€™ll need more information about how to configure it to do so. Following this link will help you with the authentication piece required for the Argo archive; then base your configuration on Controller configmap. Youâ€™ll need to have them appropriately configured with your Argo server to benefit from this feature. Once itâ€™s configured, you can store your workflows with the spec.archiveLocation.archiveLogs as demonstrated below.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: archive-location- spec: entrypoint: whalesay templates: - name: whalesay container: image: docker/whalesay:latest command: [cowsay] args: [\"hello world\"] archiveLocation: archiveLogs: true 5. Passing a Git Repository as an Input Artifact\nAnother cool feature that Argo Workflows provides out of the box is the possibility to sync your Git repository without the need for extra sidecars or init containers. The code below connects to the Argo repository on Github. You can choose from HTTP or SSH pull requests for the authentication piece. In the first template, git-clone, youâ€™ll need to use the combination of usernameSecret and passwordSecret Kubernetes secrets to access a URL in its HTTP format. You can see an example of an HTTP Git configuration in the code below.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: input-artifact-git- spec: entrypoint: git-clone templates: - name: git-clone inputs: artifacts: - name: argo-source path: /src git: repo: https://github.com/argoproj/argo-workflows.git revision: \"v2.1.1\" usernameSecret: name: github-creds key: username passwordSecret: name: github-creds key: password container: image: golang:1.10 command: [sh, -c] args: [\"git status \u0026\u0026 ls \u0026\u0026 cat VERSION\"] workingDir: /src Argo Workflows also supports SSH connectivity (e.g., git@github.com:argoproj/argo-workflows.git). However, it needs the URL format following the SSH connectivity and the sshPrivateKeySecret Kubernetes secret instead of the usernameSecret and passwordSecret ones.\n6. Creating Directed Acyclic Graph Workflows\nI feel the directed acyclic graph (DAG) is now getting the attention it deserves on the analytics domains because of how it impressively handles data processing workload steps on Apache Spark and its use as a common data orchestration pattern with Apache Airflow. With Argo Workflows, youâ€™ll have a Kubernetes-friendly interface instead of the need to configure a Kubernetes executor for Airflow which is less stable.\nI suggest checking this link to learn more about how a DAG works. Below, you can see how Argo Workflows instantiates it.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: dag-target- spec: entrypoint: dag-target arguments: parameters: - name: target value: E templates: - name: dag-target dag: target: \"{{workflow.parameters.target}}\" tasks: - name: A template: echo arguments: parameters: [{name: message, value: A}] - name: B depends: \"A\" template: echo arguments: parameters: [{name: message, value: B}] - name: C depends: \"A\" template: echo arguments: parameters: [{name: message, value: C}] - name: D depends: \"B \u0026\u0026 C\" template: echo arguments: parameters: [{name: message, value: D}] - name: E depends: \"C\" template: echo arguments: parameters: [{name: message, value: E}] - name: echo inputs: parameters: - name: message container: image: alpine:3.7 command: [echo, \"{{inputs.parameters.message}}\"] Each task will be passed to the Argo server using the target parameter name, with the target names separated by spaces. Argo Workflows will execute only the ones you specify; however, itâ€™ll run each dependency until it reaches the informed targets. In plain English, say we save our file as dag-targets.yml and execute using the following command:\nargo submit -n argo dag-targets.yml -p target=\"B E\" --watch It will skip only target D, as demonstrated below:\nArgo Workflows DAG execution results\n7. Execute Python Scripts\nContainers already make it easy to manage runtime environments. So, itâ€™s easy to build a Python container with the libraries and version you need for your Python-based workflow steps.\nWith Argo Workflows you can call a Python script thatâ€™s already installed on the container by name, or pass in code via a source field in workflow description. You can specify any valid code in the source block.\nHereâ€™s an example:\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: name: python-random-number-generator namespace: argo spec: entrypoint: generator arguments: parameters: - name: min value: 0 - name: max value: 10 templates: - name: generator inputs: parameters: - name: min - name: max script: image: python:3.8 command: [python] source: | from random import randrange range_min = {{inputs.parameters.min}} range_max = {{inputs.parameters.max}} random_number = randrange(range_min, range_max) print(\"Random number: {}\".format(random_number)) 8. Implementing a Retry Strategy\nSometimes, multiple targets can implement some retry logic, and Argo Workflows configures your retry strategy on the Workflow level.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: retry-container- spec: entrypoint: retry-container templates: - name: retry-container retryStrategy: limit: \"3\" retryPolicy: \"OnError\" container: image: python:alpine3.6 command: [\"python\", -c] # fail with a 66% probability args: [\"import random; import sys; exit_code = random.choice([0, 1, 1]); sys.exit(exit_code)\"] In our example, the target retry-container will try to restart three times in the cases that it finishes with an Error status on Kubernetes.\n9. Adding Conditional Workflows Conditional workflows are also among my favorites and are so simple to implement. You can deploy your architecture based on the return statuses of previous steps, which is very handy when orchestrating a set of containers. Argo Workflows grants you the possibility of executing targets based on a boolean condition. Under the hood, it uses govaluate to allow you to use Golangâ€™s expr statements.\nSo youâ€™ll be able to orchestrate your conditions in the same way you handle your Golang helpers on your Kubernetes ecosystemâ€”another nice extra benefit of using Kubernetes CRDs.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: conditional-parameter- labels: workflows.argoproj.io/test: \"true\" annotations: workflows.argoproj.io/version: '\u003e= 3.1.0' spec: entrypoint: main templates: - name: main steps: - - name: flip-coin template: flip-coin - - name: heads template: heads when: \"{{steps.flip-coin.outputs.result}} == heads\" - name: tails template: tails when: \"{{steps.flip-coin.outputs.result}} == tails\" outputs: parameters: - name: stepresult valueFrom: expression: \"steps['flip-coin'].outputs.result == 'heads' ? steps.heads.outputs.result : steps.tails.outputs.result\" - name: flip-coin script: image: python:alpine3.6 command: [ python ] source: | import random print(\"heads\" if random.randint(0,1) == 0 else \"tails\") - name: heads script: image: python:alpine3.6 command: [ python ] source: | print(\"heads\") - name: tails script: image: python:alpine3.6 command: [ python ] source: | print(\"tails\") Saving the above code as cond.yml and executing with argo submit will give the following output:\nargo submit -n argo cond.yml --watch 10. Managing Kubernetes Resources From Your Workflow Argo Workflows can create Kubernetes components; this is very handy when you need to develop temporary kubelet actions in a declarative way. This feature follows the same principle of the inline scripts to deploy Kubernetes components responsible for applying patches to your environment. However, Argo Workflows handles this codeâ€™s Kubernetes CRD YAML inline files.\napiVersion: argoproj.io/v1alpha1 kind: Workflow metadata: generateName: k8s-jobs- spec: entrypoint: pi-tmpl templates: - name: pi-tmpl resource: action: create successCondition: status.succeeded \u003e 0 failureCondition: status.failed \u003e 3 manifest: | apiVersion: batch/v1 kind: Job metadata: generateName: pi-job- spec: template: metadata: name: pi spec: containers: - name: pi image: perl command: [\"perl\", \"-Mbignum=bpi\", \"-wle\", \"print bpi(2000)\"] restartPolicy: Never backoffLimit: 4 This feature covers you as you directly run all kubectl actions, which allows you to create/update/delete any Kubernetes resource on your cluster using inline Kubernetes API groups definitions.\nConclusion\nThe advances weâ€™ve seen in systems management and development give us many reasons to be optimistic. For instance, infrastructure as code allows you to have the same infrastructure on your scalable servers and your local workstation. Tools like Argo Workflows help us create scalable production-ready infrastructure on our local workstation, and that by itself is something to cherish.\nWith constant infrastructure requirement changes such as dynamic DNS, you need to adapt your deployments to a more modular approach. These workflows are the must-haves for any DevOps admin. But this list is only the beginning. I would highly suggest implementing these scripts in your development and data pipelines.\nUntil next time!\n",
  "wordCount" : "1949",
  "inLanguage": "en",
  "image":"https://user-images.githubusercontent.com/78096758/217081520-1f3b6771-8cf8-434b-b8fe-d11c17d380b5.png","datePublished": "2022-07-12T00:00:00Z",
  "dateModified": "2022-07-12T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Daniel Paes"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.dawrlog.com/posts/6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Dataware Logistics",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.dawrlog.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.dawrlog.com/" accesskey="h" title="Dataware Logistics (Alt + H)">Dataware Logistics</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://www.dawrlog.com/fr/" title="French"
                            aria-label=":fr:">ðŸ‡«ðŸ‡·</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.dawrlog.com/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://www.dawrlog.com/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://calendly.com/dawrlog" title="Contact">
                    <span>Contact</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.dawrlog.com/">Home</a>&nbsp;Â»&nbsp;<a href="https://www.dawrlog.com/posts/">Posts</a></div>
    <h1 class="post-title">
      Top 10 Argo Workflows Examples.
    </h1>
    <div class="post-meta"><span title='2022-07-12 00:00:00 +0000 UTC'>July 12, 2022</span>&nbsp;Â·&nbsp;10 min&nbsp;Â·&nbsp;Daniel Paes

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://user-images.githubusercontent.com/78096758/217081520-1f3b6771-8cf8-434b-b8fe-d11c17d380b5.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#h2argo-workflows-setuph2br-"><h2>Argo Workflows Setup</h2><br /></a></li>
    <li><a href="#h21-enhancing-your-workflow-using-parametersh2br-"><h2>1. Enhancing Your Workflow Using Parameters</h2><br /></a></li>
    <li><a href="#h22-pulling-images-from-your-secured-repositoryh2br-"><h2>2. Pulling Images From Your Secured Repository</h2><br /></a></li>
    <li><a href="#h23-using-sidecar-containers-h2br-"><h2>3. Using Sidecar Containers </h2><br /></a></li>
    <li><a href="#h24-archiving-your-current-workflow-state-on-persistent-storageh2br-"><h2>4. Archiving Your Current Workflow State on Persistent Storage</h2><br /></a></li>
    <li><a href="#h25-passing-a-git-repository-as-an-input-artifacth2br-"><h2>5. Passing a Git Repository as an Input Artifact</h2><br /></a></li>
    <li><a href="#h26-creating-directed-acyclic-graph-workflowsh2br-"><h2>6. Creating Directed Acyclic Graph Workflows</h2><br /></a></li>
    <li><a href="#h27-execute-python-scriptsh2br-"><h2>7. Execute Python Scripts</h2><br /></a></li>
    <li><a href="#h28-implementing-a-retry-strategyh2br-"><h2>8. Implementing a Retry Strategy</h2><br /></a></li>
    <li><a href="#h29-adding-conditional-workflows-h2br-"><h2>9. Adding Conditional Workflows </h2><br /></a></li>
    <li><a href="#h2-10-managing-kubernetes-resources-from-your-workflow-h2br-"><h2> 10. Managing Kubernetes Resources From Your Workflow </h2><br /></a></li>
    <li><a href="#h2conclusionh2br-"><h2>Conclusion</h2><br /></a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>We all know how <a href="https://argoproj.github.io/argo-workflows/">Argo Workflows</a> makes it easy to orchestrate parallel jobs on Kubernetes. While itâ€™s most often associated with data processing and ETL projects, itâ€™s useful for a lot more! These 10 workflows will change the way you see this Kubernetes orchestrator.</p>
<p>Letâ€™s dive in!</p>
<h2 id="h2argo-workflows-setuph2br-"><h2>Argo Workflows Setup</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h2argo-workflows-setuph2br-">#</a></h2>
<p>If you don&rsquo;t currently have a workflow running, I suggest you create your first Argo Workflow to understand what we&rsquo;ll discuss in this post. To do so, follow the instructions <a href="https://argoproj.github.io/argo-workflows/quick-start/">here</a> to create a local Argo Workflows deployment on your cluster. I also suggest using k3d for your local Kubernetes control plane; this tutorial uses a <a href="https://k3d.io/v5.3.0/#install-script">k3d</a> cluster named argo. Feel free to reproduce the command below to create it in your environment:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">k3d cluster create argo
</span></span><span class="line"><span class="cl">kubectl create -n argo -f https://raw.githubusercontent.com/argoproj/argo-workflows/master/manifests/quick-start-postgres.yaml
</span></span><span class="line"><span class="cl">kubectl -n argo port-forward deployment/argo-server 2746:2746 <span class="p">&amp;</span> 
</span></span></code></pre></div><p>Now let&rsquo;s jump into looking at our first example!</p>
<h2 id="h21-enhancing-your-workflow-using-parametersh2br-"><h2>1. Enhancing Your Workflow Using Parameters</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h21-enhancing-your-workflow-using-parametersh2br-">#</a></h2>
<p>Argo uses <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resource definitions</a> stored on YAML files to manage its deployments. So no need to learn new specs to manage your infrastructure; you can follow the same pattern used on your Kubernetes and <a href="https://kustomize.io/">Kustomize</a> scripts, which helps you remain consistent. Below we can see how to use parameters on your workflows, and passing parameters is handy when your configuration uses runtime values. As a result, you will know some components only after creating them, such as <a href="https://en.wikipedia.org/wiki/Access_token">access tokens</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: hello-world-parameters-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: whalesay
</span></span><span class="line"><span class="cl">  arguments:
</span></span><span class="line"><span class="cl">    parameters:
</span></span><span class="line"><span class="cl">    - name: message
</span></span><span class="line"><span class="cl">      value: Message string default value 
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: whalesay
</span></span><span class="line"><span class="cl">    inputs:
</span></span><span class="line"><span class="cl">      parameters:
</span></span><span class="line"><span class="cl">      - name: message
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: docker/whalesay
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>cowsay<span class="o">]</span>
</span></span><span class="line"><span class="cl">      args: <span class="o">[</span><span class="s2">&#34;{{inputs.parameters.message}}&#34;</span><span class="o">]</span> 
</span></span></code></pre></div><p>In our template, the parameter <code>message</code> will have the default value of <code>Message string default value</code>. However, this value can be overwritten at runtime, as we can see by running the command below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">argo submit -n argo param.yml -p <span class="nv">message</span><span class="o">=</span><span class="s2">&#34;This ran from your container&#34;</span> --watch 
</span></span></code></pre></div><p>We can validate the output from the Argo Workflows Logs UI. (You can access the UI by default at <code>https://localhost:2746/</code> if you quickly follow the port forwarding instructions while creating your cluster.)</p>
<h2 id="h22-pulling-images-from-your-secured-repositoryh2br-"><h2>2. Pulling Images From Your Secured Repository</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h22-pulling-images-from-your-secured-repositoryh2br-">#</a></h2>
<p>One of the features I like when automating an ecosystem is using rotational access keys while managing my services&rsquo; access. This is useful in cases where your company uses private container repositories to host your container images. Argo Workflows helps you achieve this with the native support of Kubernetes secrets. In our example, we can see that the secret <code>docker-registry-secret</code> will pull the image <code>docker/whalesay:latest</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: hello-world-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: whalesay
</span></span><span class="line"><span class="cl">  imagePullSecrets:
</span></span><span class="line"><span class="cl">  - name: docker-registry-secret
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: whalesay
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: docker/whalesay:latest
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>cowsay<span class="o">]</span>
</span></span><span class="line"><span class="cl">      args: <span class="o">[</span><span class="s2">&#34;hello world&#34;</span><span class="o">]</span> 
</span></span></code></pre></div><h2 id="h23-using-sidecar-containers-h2br-"><h2>3. Using Sidecar Containers </h2><br /><a hidden class="anchor" aria-hidden="true" href="#h23-using-sidecar-containers-h2br-">#</a></h2>
<p>One of my favorite things to do is to use sidecars while starting my pods. Kubernetes sidecars are useful helpers that can handle recurring tasks, such as syncing your Git repositories with <code>git-sync</code> as shown <a href="https://github.com/kubernetes/git-sync">here</a>. Argo Workflows has this covered with neat support for sidecar containers out of the box.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: sidecar-nginx-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: sidecar-nginx-example
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: sidecar-nginx-example
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: appropriate/curl
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>sh, -c<span class="o">]</span>
</span></span><span class="line"><span class="cl">      args: <span class="o">[</span><span class="s2">&#34;until `curl -G &#39;http://127.0.0.1/&#39; &gt;&amp; /tmp/out`; do echo sleep &amp;&amp; sleep 1; done &amp;&amp; cat /tmp/out&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    sidecars:
</span></span><span class="line"><span class="cl">    - name: nginx
</span></span><span class="line"><span class="cl">      image: nginx:1.13 
</span></span></code></pre></div><p>To deploy it, save the above code as <code>sidecar-nginx.yml</code> and submit it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">argo submit -n argo sidecar-nginx.yml --watch 
</span></span></code></pre></div><p>And as a result, you&rsquo;ll deploy an NGINX&rsquo;s reverse proxy sidecar instance.</p>
<p><em>**Pro-tip: You might need to pay some extra attention to your workflows if youâ€™re using <a href="https://istio.io/">Istio</a> as Service mesh. Check out at this GitHub thread if you&rsquo;re thinking of using it. **</em></p>
<h2 id="h24-archiving-your-current-workflow-state-on-persistent-storageh2br-"><h2>4. Archiving Your Current Workflow State on Persistent Storage</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h24-archiving-your-current-workflow-state-on-persistent-storageh2br-">#</a></h2>
<p>Workflow Archive is a nice feature that Argo Workflows provides so you can have previous workflow states stored on a relational database (Postgres or MySQL for now). However, Argo&rsquo;s archive won&rsquo;t keep detailed execution logs; you&rsquo;ll need to configure an Object storage as <a href="https://argoproj.github.io/argo-workflows/configure-artifact-repository/">artifact repository</a>, it can be an opensource option like <a href="https://min.io/">MinIO</a>, or <a href="https://aws.amazon.com/s3/">AWS S3</a>; to mention a cloud provider option from AWS.</p>
<p>To use the archive feature, you&rsquo;ll first need to configure your Argo server&rsquo;s persistent storage option. You&rsquo;ll need more information about how to configure it to do so. Following this link will help you with the authentication piece required for the Argo archive; then base your configuration on <a href="https://argoproj.github.io/argo-workflows/workflow-controller-configmap/">Controller configmap</a>. You&rsquo;ll need to have them appropriately configured with your Argo server to benefit from this feature. Once it&rsquo;s configured, you can store your workflows with the <code>spec.archiveLocation.archiveLogs</code> as demonstrated below.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: archive-location-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: whalesay
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: whalesay
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: docker/whalesay:latest
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>cowsay<span class="o">]</span>
</span></span><span class="line"><span class="cl">      args: <span class="o">[</span><span class="s2">&#34;hello world&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    archiveLocation:
</span></span><span class="line"><span class="cl">      archiveLogs: <span class="nb">true</span> 
</span></span></code></pre></div><h2 id="h25-passing-a-git-repository-as-an-input-artifacth2br-"><h2>5. Passing a Git Repository as an Input Artifact</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h25-passing-a-git-repository-as-an-input-artifacth2br-">#</a></h2>
<p>Another cool feature that Argo Workflows provides out of the box is the possibility to sync your Git repository without the need for extra sidecars or init containers. The code below connects to the <a href="https://github.com/argoproj/argo-workflows.git">Argo repository</a> on Github. You can choose from HTTP or SSH pull requests for the authentication piece. In the first template, git-clone, you&rsquo;ll need to use the combination of usernameSecret and passwordSecret Kubernetes secrets to access a URL in its HTTP format. You can see an example of an HTTP Git configuration in the code below.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: input-artifact-git-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: git-clone
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: git-clone
</span></span><span class="line"><span class="cl">    inputs:
</span></span><span class="line"><span class="cl">      artifacts:
</span></span><span class="line"><span class="cl">      - name: argo-source
</span></span><span class="line"><span class="cl">        path: /src
</span></span><span class="line"><span class="cl">        git:
</span></span><span class="line"><span class="cl">          repo: https://github.com/argoproj/argo-workflows.git
</span></span><span class="line"><span class="cl">          revision: <span class="s2">&#34;v2.1.1&#34;</span>
</span></span><span class="line"><span class="cl">          usernameSecret:
</span></span><span class="line"><span class="cl">            name: github-creds
</span></span><span class="line"><span class="cl">            key: username
</span></span><span class="line"><span class="cl">          passwordSecret:
</span></span><span class="line"><span class="cl">            name: github-creds
</span></span><span class="line"><span class="cl">            key: password
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: golang:1.10
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>sh, -c<span class="o">]</span>
</span></span><span class="line"><span class="cl">      args: <span class="o">[</span><span class="s2">&#34;git status &amp;&amp; ls &amp;&amp; cat VERSION&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">      workingDir: /src 
</span></span></code></pre></div><p>Argo Workflows also supports SSH connectivity (e.g., <code>git@github.com:argoproj/argo-workflows.git</code>). However, it needs the URL format following the SSH connectivity and the <code>sshPrivateKeySecret</code> Kubernetes secret instead of the <code>usernameSecret</code> and <code>passwordSecret</code> ones.</p>
<h2 id="h26-creating-directed-acyclic-graph-workflowsh2br-"><h2>6. Creating Directed Acyclic Graph Workflows</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h26-creating-directed-acyclic-graph-workflowsh2br-">#</a></h2>
<p>I feel the directed acyclic graph (DAG) is now getting the attention it deserves on the analytics domains because of how it impressively handles data processing workload steps on <a href="https://spark.apache.org/docs/3.2.1/index.html">Apache Spark</a> and its use as a common data orchestration pattern with Apache Airflow. With Argo Workflows, you&rsquo;ll have a Kubernetes-friendly interface instead of the need to configure a Kubernetes executor for Airflow which is less stable.</p>
<p>I suggest checking this <a href="https://www.techopedia.com/definition/5739/directed-acyclic-graph-dag">link</a> to learn more about how a DAG works. Below, you can see how Argo Workflows instantiates it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: dag-target-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: dag-target
</span></span><span class="line"><span class="cl">  arguments:
</span></span><span class="line"><span class="cl">    parameters:
</span></span><span class="line"><span class="cl">    - name: target
</span></span><span class="line"><span class="cl">      value: E
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: dag-target
</span></span><span class="line"><span class="cl">    dag:
</span></span><span class="line"><span class="cl">      target: <span class="s2">&#34;{{workflow.parameters.target}}&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      tasks:
</span></span><span class="line"><span class="cl">      - name: A
</span></span><span class="line"><span class="cl">        template: <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        arguments:
</span></span><span class="line"><span class="cl">          parameters: <span class="o">[{</span>name: message, value: A<span class="o">}]</span>
</span></span><span class="line"><span class="cl">      - name: B
</span></span><span class="line"><span class="cl">        depends: <span class="s2">&#34;A&#34;</span>
</span></span><span class="line"><span class="cl">        template: <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        arguments:
</span></span><span class="line"><span class="cl">          parameters: <span class="o">[{</span>name: message, value: B<span class="o">}]</span>
</span></span><span class="line"><span class="cl">      - name: C
</span></span><span class="line"><span class="cl">        depends: <span class="s2">&#34;A&#34;</span>
</span></span><span class="line"><span class="cl">        template: <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        arguments:
</span></span><span class="line"><span class="cl">          parameters: <span class="o">[{</span>name: message, value: C<span class="o">}]</span>
</span></span><span class="line"><span class="cl">      - name: D
</span></span><span class="line"><span class="cl">        depends: <span class="s2">&#34;B &amp;&amp; C&#34;</span>
</span></span><span class="line"><span class="cl">        template: <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        arguments:
</span></span><span class="line"><span class="cl">          parameters: <span class="o">[{</span>name: message, value: D<span class="o">}]</span>
</span></span><span class="line"><span class="cl">      - name: E
</span></span><span class="line"><span class="cl">        depends: <span class="s2">&#34;C&#34;</span>
</span></span><span class="line"><span class="cl">        template: <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">        arguments:
</span></span><span class="line"><span class="cl">          parameters: <span class="o">[{</span>name: message, value: E<span class="o">}]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  - name: <span class="nb">echo</span>
</span></span><span class="line"><span class="cl">    inputs:
</span></span><span class="line"><span class="cl">      parameters:
</span></span><span class="line"><span class="cl">      - name: message
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: alpine:3.7
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>echo, <span class="s2">&#34;{{inputs.parameters.message}}&#34;</span><span class="o">]</span> 
</span></span></code></pre></div><p>Each task will be passed to the Argo server using the <code>target</code> parameter name, with the target names separated by spaces. Argo Workflows will execute only the ones you specify; however, it&rsquo;ll run each dependency until it reaches the informed targets. In plain English, say we save our file as <code>dag-targets.yml</code>  and execute using the following command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">argo submit -n argo dag-targets.yml -p <span class="nv">target</span><span class="o">=</span><span class="s2">&#34;B E&#34;</span> --watch
</span></span></code></pre></div><p>It will skip only <strong>target D</strong>, as demonstrated below:</p>
<p><img loading="lazy" src="/img/posts/argo-dag-results.png" alt="argo workflow examples"  />

<em>Argo Workflows DAG execution results</em></p>
<h2 id="h27-execute-python-scriptsh2br-"><h2>7. Execute Python Scripts</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h27-execute-python-scriptsh2br-">#</a></h2>
<p>Containers already make it easy to manage runtime environments. So, itâ€™s easy to build a Python container with the libraries and version you need for your Python-based workflow steps.</p>
<p>With Argo Workflows you can call a Python script thatâ€™s already installed on the container by name, or pass in code via a <code>source</code> field in workflow description. You can specify any valid code in the source block.</p>
<p>Hereâ€™s an example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: python-random-number-generator
</span></span><span class="line"><span class="cl">  namespace: argo
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: generator
</span></span><span class="line"><span class="cl">  arguments:
</span></span><span class="line"><span class="cl">    parameters:
</span></span><span class="line"><span class="cl">      - name: min
</span></span><span class="line"><span class="cl">        value: <span class="m">0</span>
</span></span><span class="line"><span class="cl">      - name: max
</span></span><span class="line"><span class="cl">        value: <span class="m">10</span>
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: generator
</span></span><span class="line"><span class="cl">    inputs:
</span></span><span class="line"><span class="cl">      parameters:
</span></span><span class="line"><span class="cl">        - name: min
</span></span><span class="line"><span class="cl">        - name: max
</span></span><span class="line"><span class="cl">    script:
</span></span><span class="line"><span class="cl">      image: python:3.8
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span>python<span class="o">]</span>
</span></span><span class="line"><span class="cl">      source: <span class="p">|</span>
</span></span><span class="line"><span class="cl">        from random import randrange
</span></span><span class="line"><span class="cl">        <span class="nv">range_min</span> <span class="o">=</span> <span class="o">{{</span>inputs.parameters.min<span class="o">}}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">range_max</span> <span class="o">=</span> <span class="o">{{</span>inputs.parameters.max<span class="o">}}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">random_number</span> <span class="o">=</span> randrange<span class="o">(</span>range_min, range_max<span class="o">)</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;Random number: {}&#34;</span>.format<span class="o">(</span>random_number<span class="o">))</span> 
</span></span></code></pre></div><h2 id="h28-implementing-a-retry-strategyh2br-"><h2>8. Implementing a Retry Strategy</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h28-implementing-a-retry-strategyh2br-">#</a></h2>
<p>Sometimes, multiple targets can implement some retry logic, and Argo Workflows configures your <a href="https://argoproj.github.io/argo-workflows/retries/">retry strategy</a> on the Workflow level.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: retry-container-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: retry-container
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: retry-container
</span></span><span class="line"><span class="cl">    retryStrategy:
</span></span><span class="line"><span class="cl">      limit: <span class="s2">&#34;3&#34;</span>
</span></span><span class="line"><span class="cl">      retryPolicy: <span class="s2">&#34;OnError&#34;</span>
</span></span><span class="line"><span class="cl">    container:
</span></span><span class="line"><span class="cl">      image: python:alpine3.6
</span></span><span class="line"><span class="cl">      command: <span class="o">[</span><span class="s2">&#34;python&#34;</span>, -c<span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># fail with a 66% probability</span>
</span></span><span class="line"><span class="cl">      args: <span class="o">[</span><span class="s2">&#34;import random; import sys; exit_code = random.choice([0, 1, 1]); sys.exit(exit_code)&#34;</span><span class="o">]</span> 
</span></span></code></pre></div><p>In our example, the target <code>retry-container</code> will try to restart three times in the cases that it finishes with an Error status on Kubernetes.</p>
<h2 id="h29-adding-conditional-workflows-h2br-"><h2>9. Adding Conditional Workflows </h2><br /><a hidden class="anchor" aria-hidden="true" href="#h29-adding-conditional-workflows-h2br-">#</a></h2>
<p>Conditional workflows are also among my favorites and are so simple to implement. You can deploy your architecture based on the return statuses of previous steps, which is very handy when orchestrating a set of containers. Argo Workflows grants you the possibility of executing targets based on a boolean condition. Under the hood, it uses <a href="https://github.com/Knetic/govaluate">govaluate</a> to allow you to use <a href="https://github.com/antonmedv/expr">Golang&rsquo;s expr statements</a>.</p>
<p>So you&rsquo;ll be able to orchestrate your conditions in the same way you handle your Golang helpers on your Kubernetes ecosystemâ€”another nice extra benefit of using Kubernetes CRDs.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: conditional-parameter-
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    workflows.argoproj.io/test: <span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">  annotations:
</span></span><span class="line"><span class="cl">    workflows.argoproj.io/version: <span class="s1">&#39;&gt;= 3.1.0&#39;</span>
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: main
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">    - name: main
</span></span><span class="line"><span class="cl">      steps:
</span></span><span class="line"><span class="cl">        - - name: flip-coin
</span></span><span class="line"><span class="cl">            template: flip-coin
</span></span><span class="line"><span class="cl">        - - name: heads
</span></span><span class="line"><span class="cl">            template: heads
</span></span><span class="line"><span class="cl">            when: <span class="s2">&#34;{{steps.flip-coin.outputs.result}} == heads&#34;</span>
</span></span><span class="line"><span class="cl">          - name: tails
</span></span><span class="line"><span class="cl">            template: tails
</span></span><span class="line"><span class="cl">            when: <span class="s2">&#34;{{steps.flip-coin.outputs.result}} == tails&#34;</span>
</span></span><span class="line"><span class="cl">      outputs:
</span></span><span class="line"><span class="cl">        parameters:
</span></span><span class="line"><span class="cl">          - name: stepresult
</span></span><span class="line"><span class="cl">            valueFrom:
</span></span><span class="line"><span class="cl">              expression: <span class="s2">&#34;steps[&#39;flip-coin&#39;].outputs.result == &#39;heads&#39; ? steps.heads.outputs.result : steps.tails.outputs.result&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    - name: flip-coin
</span></span><span class="line"><span class="cl">      script:
</span></span><span class="line"><span class="cl">        image: python:alpine3.6
</span></span><span class="line"><span class="cl">        command: <span class="o">[</span> python <span class="o">]</span>
</span></span><span class="line"><span class="cl">        source: <span class="p">|</span>
</span></span><span class="line"><span class="cl">          import random
</span></span><span class="line"><span class="cl">          print<span class="o">(</span><span class="s2">&#34;heads&#34;</span> <span class="k">if</span> random.randint<span class="o">(</span>0,1<span class="o">)</span> <span class="o">==</span> <span class="m">0</span> <span class="k">else</span> <span class="s2">&#34;tails&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    - name: heads
</span></span><span class="line"><span class="cl">      script:
</span></span><span class="line"><span class="cl">        image: python:alpine3.6
</span></span><span class="line"><span class="cl">        command: <span class="o">[</span> python <span class="o">]</span>
</span></span><span class="line"><span class="cl">        source: <span class="p">|</span>
</span></span><span class="line"><span class="cl">          print<span class="o">(</span><span class="s2">&#34;heads&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    - name: tails
</span></span><span class="line"><span class="cl">      script:
</span></span><span class="line"><span class="cl">        image: python:alpine3.6
</span></span><span class="line"><span class="cl">        command: <span class="o">[</span> python <span class="o">]</span>
</span></span><span class="line"><span class="cl">        source: <span class="p">|</span>
</span></span><span class="line"><span class="cl">          print<span class="o">(</span><span class="s2">&#34;tails&#34;</span><span class="o">)</span> 
</span></span></code></pre></div><p>Saving the above code as <code>cond.yml</code> and executing with <code>argo submit</code> will give the following output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">argo submit -n argo cond.yml --watch 
</span></span></code></pre></div><br />
<p><img loading="lazy" src="https://user-images.githubusercontent.com/78096758/217082060-b565c064-74fb-457a-b7ae-6035e81019bb.png#center" alt="Argo Workflows conditional execution results"  />
</p>
<h2 id="h2-10-managing-kubernetes-resources-from-your-workflow-h2br-"><h2> 10. Managing Kubernetes Resources From Your Workflow </h2><br /><a hidden class="anchor" aria-hidden="true" href="#h2-10-managing-kubernetes-resources-from-your-workflow-h2br-">#</a></h2>
<p>Argo Workflows can create Kubernetes components; this is very handy when you need to develop temporary kubelet actions in a declarative way. This feature follows the same principle of the inline scripts to deploy Kubernetes components responsible for applying patches to your environment. However, Argo Workflows handles this code&rsquo;s <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions">Kubernetes CRD</a> YAML inline files.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apiVersion: argoproj.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: Workflow
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  generateName: k8s-jobs-
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  entrypoint: pi-tmpl
</span></span><span class="line"><span class="cl">  templates:
</span></span><span class="line"><span class="cl">  - name: pi-tmpl
</span></span><span class="line"><span class="cl">    resource:                  
</span></span><span class="line"><span class="cl">      action: create           
</span></span><span class="line"><span class="cl">      successCondition: status.succeeded &gt; <span class="m">0</span>
</span></span><span class="line"><span class="cl">      failureCondition: status.failed &gt; <span class="m">3</span>
</span></span><span class="line"><span class="cl">      manifest: <span class="p">|</span>               
</span></span><span class="line"><span class="cl">        apiVersion: batch/v1
</span></span><span class="line"><span class="cl">        kind: Job
</span></span><span class="line"><span class="cl">        metadata:
</span></span><span class="line"><span class="cl">          generateName: pi-job-
</span></span><span class="line"><span class="cl">        spec:
</span></span><span class="line"><span class="cl">          template:
</span></span><span class="line"><span class="cl">            metadata:
</span></span><span class="line"><span class="cl">              name: pi
</span></span><span class="line"><span class="cl">            spec:
</span></span><span class="line"><span class="cl">              containers:
</span></span><span class="line"><span class="cl">              - name: pi
</span></span><span class="line"><span class="cl">                image: perl
</span></span><span class="line"><span class="cl">                command: <span class="o">[</span><span class="s2">&#34;perl&#34;</span>,  <span class="s2">&#34;-Mbignum=bpi&#34;</span>, <span class="s2">&#34;-wle&#34;</span>, <span class="s2">&#34;print bpi(2000)&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">              restartPolicy: Never
</span></span><span class="line"><span class="cl">          backoffLimit: <span class="m">4</span> 
</span></span></code></pre></div><p>This feature covers you as you directly run all kubectl actions, which allows you to create/update/delete any Kubernetes resource on your cluster using inline <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/">Kubernetes API groups</a> definitions.</p>
<h2 id="h2conclusionh2br-"><h2>Conclusion</h2><br /><a hidden class="anchor" aria-hidden="true" href="#h2conclusionh2br-">#</a></h2>
<p>The advances weâ€™ve seen in systems management and development give us many reasons to be optimistic. For instance, <a href="https://en.wikipedia.org/wiki/Infrastructure_as_code">infrastructure as code</a> allows you to have the same infrastructure on your scalable servers and your local workstation. Tools like Argo Workflows help us create scalable production-ready infrastructure on our local workstation, and that by itself is something to cherish.</p>
<p>With constant infrastructure requirement changes such as <a href="https://en.wikipedia.org/wiki/Dynamic_DNS#:~:text=Dynamic%20DNS%20(DDNS)%20is%20a,hostnames%2C%20addresses%20or%20other%20information.">dynamic DNS</a>, you need to adapt your deployments to a more modular approach. These workflows are the must-haves for any DevOps admin. But this list is only the beginning. I would highly suggest implementing these scripts in your development and data pipelines.</p>
<p>Until next time!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.dawrlog.com/tags/kubernetes/">Kubernetes</a></li>
      <li><a href="https://www.dawrlog.com/tags/argo/">Argo</a></li>
      <li><a href="https://www.dawrlog.com/tags/development/">Development</a></li>
      <li><a href="https://www.dawrlog.com/tags/infrastructure-observability/">Infrastructure Observability</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://www.dawrlog.com/posts/5/">
    <span class="title">Â« Prev</span>
    <br>
    <span>Argo Workflow ETL Examples.</span>
  </a>
  <a class="next" href="https://www.dawrlog.com/posts/4/">
    <span class="title">Next Â»</span>
    <br>
    <span>Ways to Debug an Argo Workflow.</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Top 10 Argo Workflows Examples. on twitter"
        href="https://twitter.com/intent/tweet/?text=Top%2010%20Argo%20Workflows%20Examples.&amp;url=https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f&amp;hashtags=Kubernetes%2cArgo%2cDevelopment%2cInfrastructureObservability">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Top 10 Argo Workflows Examples. on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f&amp;title=Top%2010%20Argo%20Workflows%20Examples.&amp;summary=Top%2010%20Argo%20Workflows%20Examples.&amp;source=https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Top 10 Argo Workflows Examples. on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f&title=Top%2010%20Argo%20Workflows%20Examples.">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Top 10 Argo Workflows Examples. on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Top 10 Argo Workflows Examples. on whatsapp"
        href="https://api.whatsapp.com/send?text=Top%2010%20Argo%20Workflows%20Examples.%20-%20https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Top 10 Argo Workflows Examples. on telegram"
        href="https://telegram.me/share/url?text=Top%2010%20Argo%20Workflows%20Examples.&amp;url=https%3a%2f%2fwww.dawrlog.com%2fposts%2f6%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://www.dawrlog.com/">Dataware Logistics</a>; <br /> created with ðŸ§¡ on ðŸ§ machines running â˜¸ï¸ pods.</span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
<script>
  kofiWidgetOverlay.draw('dawrlog', {
    'type': 'floating-chat',
    'floating-chat.donateButton.text': 'Tip jar',
    'floating-chat.donateButton.background-color': '#794bc4',
    'floating-chat.donateButton.text-color': '#fff'
  });
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
